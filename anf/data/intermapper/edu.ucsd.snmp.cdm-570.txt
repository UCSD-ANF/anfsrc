<!--
    SNMP Comtech CDM-570 Status Probe
    This probe gathers data from several OIDs to display
    information about a Comtech modem

    Initially by Brian Battistuz 5/18/2007
    Modified by Steve Foley 5/30/2007 (v1.0)
    Modified by Steve Foley 6/6/2007 (v1.1)
-->

<header>
    "type"          =   "custom-snmp"
    "package"       =   "edu.ucsd"
    "probe_name"    =   "snmp.cdm-570"
    "human_name"    =   "SNMP Comtech CDM-570 satellite modem probe"
    "display_name"  =   "IGPP Custom/SNMP Comtech CDM-570 satellite modem probe"
    "version"       =   "1.1"
    "address_type"  =   "IP"
    "port_number"   =   "161"
    display_name    =   "SNMP Comtech CDM-570 satellite modem probe"
</header>

<snmp-device-properties>
    -- none required; see the Developer Guide for the values that go here.
</snmp-device-properties>

<description>
\GB\SNMP CDM-570 Status Probe\P\

This probe gathers data from several OIDs to display alarm status and receive signal status information from a Comtech CDM-570 satellite modem.

The parameters are:

\b\TempThreshold\p\ Alarm when the temperature gets above this value.

\b\EbNoThreshold\p\ Alarm when the EbNo gets ABOVE this value. This checks for crazy blaring amplifiers that seem to be indicators of problems.

</description>

-- Parameters are user-settable values that the probe uses for its comparisons.
-- Specify the default values here. The customer can change them and they will be retained for each device.

<parameters>
     "TempThreshold" = "110"
     "EbNoThreshold" = "16"
</parameters>

-- SNMP values to be retrieved from the device, and 
-- Specify the variable name, its OID, a format (usually DEFAULT) and a short description.
-- CALCULATION variables are computed from other values already retrieved from the device.

<snmp-device-variables>
    modemTemp,     CDM-570::cdm570Temperature.0, DEFAULT, "Modem Temp in deg C"
    alarmStatus,   CDM-570::cdm570UnitAlarms.0, DEFAULT, "Alarm Status"
    txAlarmStatus, CDM-570::cdm570TxAlarms.0, DEFAULT, "Tx Alarm Status"
    rxAlarmStatus, CDM-570::cdm570RxAlarms.0, DEFAULT, "Rx Alarm Status"
    berMultiplier, CDM-570::cdm570RxBERMultiplier.0, DEFAULT, "Rx BER (scale by 10E-10"
    rxFreqOffset,  CDM-570::cdm570RxFrequencyOffset.0, DEFAULT, "Rx Freq Offset in Hz"
    rxSignalLevel, CDM-570::cdm570RxSignalLevel.0, DEFAULT, "Rx Signal Level in dBm"
    rxEbNo,        CDM-570::cdm570RxEbNo.0,DEFAULT, "Rx EbNo in 1/10 of dB" 

    rxFreq,	   CDM-570::cdm570RxFrequency.0,DEFAULT, "Rx frequency in Hz"
    rxDataRate,	   CDM-570::cdm570RxDataRate.0,DEFAULT, "Rx data rate in bps"

    tempDegF, (($modemTemp * 1.8) +32), CALCULATION, "Modem Temp in deg F"
    ebno, ($rxEbNo / 10), CALCULATION, "EbNo in dB"
    ber, ($berMultiplier / pow(10,10)), CALCULATION, "BER scaled by 10E-10"
    rxFreqOffsetKhz, ($rxFreqOffset / 1000), CALCULATION, "Rx Freq Offset in kHz"
    rxFreqKhz, ($rxFreq / 1000000), CALCULATION, "Rx Freq in kHz"
    rxDataRateKbps, ($rxDataRate / 1000), CALCULATION, "Rx Data Rate in kbps"

</snmp-device-variables>

-- Specify rules for setting the device into Alarm or Warning state

<snmp-device-thresholds>
   alarm: $alarmStatus != 0 "Unit Alarm condition exists"
   alarm: $txAlarmStatus != 0 "Tx Alarm condition exists"
   alarm: $rxAlarmStatus > 1 "Rx Alarm condition exists"
   alarm: $tempDegF > $TempThreshold "Temperature too high! Threshold: $TempThreshold, Current: $tempDegF"
   warning: $rxAlarmStatus = 1 "Rx Demod Unlocked"
   alarm: ($ebno > $EbNoThreshold)&&($ebno < 99) "EbNo above threshold. Threshold: $EbNoThreshold, Current: $ebno"
   
</snmp-device-thresholds>

-- The <snmp-device-display> section specifies the text that will be appended 
-- to the device's Staus Window. 

<snmp-device-display>
\B5\Modem Configuration\p\
 \4\     Rx Frequency:\0\	${chartable: ####.#### : $rxFreqKhz} kHz
 \4\     Rx Data Rate:\0\	${chartable: ### : $rxDataRateKbps} kbps

\B5\SNMP System Status Probe\p\
 \4\     Rx EbNo:\0\		${chartable: #.# : $ebno} dB
 \4\     BER:\0\		${chartable: #.## : $ber} Scaled by 10E-10
 \4\     Rx Freq. Offset:\0\	${chartable: #.## : $rxFreqOffsetKhz} kHz
 \4\     Rx Signal Level:\0\	${chartable: #.# : $rxSignalLevel} dBm

 \4\     Temperature:\0\	$modemTemp deg C ($tempDegF deg F)
 \4\     Unit Alarm Status:\0\	$alarmStatus (0 is normal)
 \4\     Rx Alarm Status:\0\	$rxAlarmStatus (0 is normal)
 \4\     Tx Alarm Status:\0\	$txAlarmStatus (0 is normal)

</snmp-device-display>
