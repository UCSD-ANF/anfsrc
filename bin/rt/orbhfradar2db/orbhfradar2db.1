.TH ORBHFRADAR2DB 1 "$Date: 2006/02/21 02:18:49 $"
.SH NAME
orbhfradar2db \- take HF Radar packets from an orb and store in a directory hierarchy
.SH SYNOPSIS
.nf
\fBorbhfradar2db \fP[-v] [-o] [-m \fImatch\fP] [-r \fIreject\fP] [-p \fIpfname\fP] [-S \fIstatefile\fP] [-d \fIdbname\fP] [-a \fIafter\fP] \fIorbname\fP \fIbuilddir\fP
.fi
.SH DESCRIPTION
\fBorbhfradar2db\fP takes data-packets for high-frequency radar data, for 
example CODAR (Coastal Ocean Dynamics
Applications Radar) data, from an orbserver (given by \fIorbname\fP on the 
command line), unwraps them, and populates a directory
structure with the packet contents, writing one packet per file. The
files are named according to their orb timestamps, based on a format
specification compatible with the epoch2str(3) command, as given in the
\fBorbhfradar2db\fP parameter file (see example below).  In addition to the 
standard epoch2str escape codes, the codes %{sta}, %{format}, and %{beampattern} 
may be used to represent the station name, format code, and beampattern code,
respectively. \fBorbhfradar2db\fP assumes the orb source-name consists entirely of the 
station-code followed by the packet-type suffix. All subdirectory
hierarchies are built in the \fIbuilddir\fP directory specified on the
command line.  A database in Codar0.4 format, given by \fIdbname\fP,
may also be populated with information on where to find the newly
written files.

.SH OPTIONS
.IP -v
Verbose output

.IP -o
Overwrite files that have identical pathnames to previous files. The default is 
not to overwrite previously created files. 

.IP "-m match"
Specify a match expression for orb packets. If this is blank, an expression
is constructed from the formats table of the parameter file. 

.IP "-r reject"
Specify a reject expression for orb packets.

.IP "-p pfname"
Specify alternate parameter-file name. The default is orbhfradar2db.pf.

.IP "-d dbname"
Store file-tracking information in the specified database in Codar0.4 format. 
This database is created if it does not already exist.

.IP "-a after"
Start acquiring orbpackets after the specified orb-stream location. This argument 
may be the string "oldest", or a time string interpretable by str2epoch(3). The 
default is to process only newly arriving packets. 

.IP "-S statefile"
This option specifies a filename in which to save the current state of the program
(i.e. the current orb read position). 

.SH PARAMETER FILE
.nf
formats &Arr{
	EXP/HFRSS4 &Arr{
		format	hfrss4
		table	radialfiles
		dfiles_pattern	Radials/%{sta}/%{format}/Rads_%Y-%m/Rad_%{beampattern}_%{sta}_%y-%m-%d_%H%M
	}
	EXP/HFRSS10LLUV &Arr{
		format	hfrss10lluv
		table	radialfiles
		dfiles_pattern	Radials/%{sta}/%{format}/Rads_%Y-%m/Rad_%{beampattern}_%{sta}_%y-%m-%d_%H%M
	}
	EXP/HFRSS10RB &Arr{
		format	hfrss10rb
		table	radialfiles
		dfiles_pattern	Radials/%{sta}/%{format}/Rads_%Y-%m/Rad_%{beampattern}_%{sta}_%y-%m-%d_%H%M
	}
	EXP/RCDRVHF &Arr{
		format	rcdrvhf1.0
		table	vectorfiles
		dfiles_pattern	Totals/HF_format/Hourlies/HFTots_%{sta}_%Y-%m/Tot_%{sta}_%Y%m%d.%H%M.mat
	}
}
.fi

.SH EXAMPLE
.in 2c
.ft CW
.nf
localhost% orbhfradar2db -v -o -a oldest -d codardb angel.ucsd.edu .
orbhfradar2db: orbhfradar2db: using match expression ".*/(EXP/RCDRR|EXP/RCDRRHF|EXP/RCDRVHF)"
orbhfradar2db: received SDLJ/EXP/RCDRVHF timestamped  1/26/2004  11:00:00.000
orbhfradar2db: Creating ./Totals/HF_format/Hourlies/HFTots_SDLJ_2004-01/Tot_SDLJ_20040126.1100.mat
orbhfradar2db: received SDLJ/EXP/RCDRVHF timestamped  1/26/2004  12:00:00.000
orbhfradar2db: Creating ./Totals/HF_format/Hourlies/HFTots_SDLJ_2004-01/Tot_SDLJ_20040126.1200.mat

.fi
.ft R
.in
.SH "SEE ALSO"
.nf
hfradar2orb(1), orbserver(1), epoch2str(3)
.fi
.SH "BUGS AND CAVEATS"
Byte order in the packet is currently left untouched: files are reproduced in the
same byte order as they were placed on the orb.

The database storage is actually optional; orbhfradar2db by default just builds a hierarchy 
of files in a directory. This may be outmoded by now; perhaps the database name should be required. 
.SH AUTHOR
.nf
Kent Lindquist
Lindquist Consulting
.fi
.\" $Id: orbhfradar2db.1,v 1.2 2006/02/21 02:18:49 lindquis Exp $
