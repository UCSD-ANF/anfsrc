.TH DBTIMELAPSE 1 "$Date: 2004/06/30 01:25:07 $"
.SH NAME
dbtimelapse \- create time-lapse movies from an image database
.SH SYNOPSIS
.nf
\fBdbtimelapse \fP[-v] [-p \fIpffile\fP] \fIdbname\fP [\fImovie\fP]
\fBdbtimelapse \fP[-v] [-p \fIpffile\fP] [-i \fIimagename\fP] [-s \fIstart\fP [-e
                \fIend\fP]] \fIdbname\fP \fIoutfile\fP
.fi
.SH DESCRIPTION
\fBdbtimelapse\fP takes an image database (Images1.0 schema) specified by \fIdbname\fP on the command line, and
creates time-lapse movies of the stored images according to the specifications of
the parameter file. A movie may be pre-defined in the parameter file (useful for automatic 
generation of up-to-date time-lapse movies for a set of image streams), or generated 
by a custom command-line specification. 

Each pre-defined \fImovie\fP to be created is specified by a block of the
parameter file, each block stored as a named array in the \fImovies\fP array. If a
\fImovie\fP name from this array is specified on the command line, that \fImovie\fP is
constructed. If no \fImovie\fP is specified on the command line, all the listed movies
are constructed.

If the -i option is used, \fBdbtimelapse\fP will generate a movie for the specified imagename 
instead of using the pre-defined movie arrays. The conversion specifics will be taken from the \fIdefault\fP
array in the parameter file (see example below). The start and end times may be overridden with -s
and -e options, which take time strings in any format parsable by the Antelope str2epoch(3) command. 
If an \fIexpression\fP is specified in the parameter file, the imagename, start and end time parameters
are ignored and the expression is used to subset the database instead [it is best to leave \fIexpression\fP
blank in the \fIdefault\fP array].

All \fImovie\fP creation is done either with the ImageMagick(1) convert(1) command or the
transcode(1) command. The parameter file specifies the \fIconverter\fP, which should be set to either
\fIconvert\fP or \fItranscode\fP.  For the convert(1) command, the parameter file
specifies a set of options to label the first and last images with a \fIstart\fP and \fIend\fP
phrase (plus optional delays to hold the \fImovie\fP at the beginning and \fIend\fP, making the looping more
clear), as well as the interframe delay. A \fIpath\fP parameter gives the output filename
for the \fImovie\fP. An \fIexpression\fP parameter gives the subsetting expression to choose the
static images which will be used for each \fImovie\fP. An \fIoptions\fP parameter allows more
ImageMagick(1) or transcode(1) options to be provided, for example to set the resolution and size of the
output \fImovie\fP. The \fIdecimation\fP parameter allows selection of only every n'th
image in the selected range (default should be set to 1 to use every image).
The \fIminframes\fP parameter specifies the minimum number of frames available
in the database for movie generation to be attempted. 
The \fItable\fP parameter specifies the database table out of which
to take the images. This allows the creation of movies from thumbnail images or precomputed
\fImovie\fP frames. The \fIstartlabel\fP, \fIendlabel\fP, and \fIdelay\fP parameters are used 
to label and pause the first and last images in a movie (these three parameters are used only 
by the 'convert' mode). If a parameter is not found in a particular block, the parameter is taken from
the \fIdefault\fP array. See the example below.
.SH OPTIONS
.IP "-p pffile"
Specify alternate parameter file. The default is \fBdbtimelapse\fP.pf
.IP -v
verbose
.IP "-i imagename"
specify imagename for custom movie generation
.IP "-s start"
specify starting time for custom movie generation. 
.IP "-e end"
specify ending time for custom movie generation

.SH PARAMETER FILE
.in 2c
.ft CW
.nf
daytime_subset time > "-24:00" && abs((time-8*3600)%86400/3600) > 5 && abs((time-8*3600)%86400/3600) < 19

dir .

default &Arr{
        converter  transcode
        options    -z -k -g 640x480 -y mpeg,null -C 3 -F 1 -f24 -H 0
        table      frames 
        startlabel -delay 300 -font helvetica -fill red -draw "text 0,10 START" 
        endlabel   -delay 300 -font helvetica -fill red -draw "text 0,10 END" 
        delay      -delay 20
        start	   -1:00
        end	  
        imagename
        expression
        decimation 1
	minframes 3
}

movies &Arr{
	PFO_thumbnail &Arr{
                converter convert
                path	&dir/pfo_thumbnail_latest.gif
                table	thumbnails
                expression imagename == "PFO_Borehole_iQeye" && &{daytime_subset}
                options
	}
	PFO_hires &Arr{
                path	&dir/pfo_hires_latest
                expression imagename == "PFO_Borehole_iQeye" && &{daytime_subset}
	}
	CE_East_Axis1 &Arr{
                converter convert
                path	&dir/ceeast_thumbnail_latest.gif
                table	thumbnails
                expression imagename == "CE_East_Axis1" && &{daytime_subset}
                options
	}
	CE_East_hires &Arr{
                path	&dir/ceeast_hires_latest
                expression imagename == "CE_East_Axis1" && &{daytime_subset}
	}
	CE_West_iQeye &Arr{
                converter convert
                path	&dir/cewest_thumbnail_latest.gif
                table	thumbnails
                expression imagename == "CE_West_iQeye" && &{daytime_subset}
                options
	}
	CE_West_hires &Arr{
                path	&dir/cewest_hires_latest.gif
                expression imagename == "CE_West_iQeye" && &{daytime_subset}
	}
	SCC_IBpier_cam &Arr{
                converter convert
                path	&dir/ibpier_thumbnail_latest.gif
                table	thumbnails
                expression imagename == "SCC_IBpier_cam" && &{daytime_subset}
                options
	}
	SCC_IBpier_hires &Arr{
                path	&dir/ibpier_hires_latest
                expression imagename == "SCC_IBpier_cam" && &{daytime_subset}
	}
	SIO_Revelle_Axis1 &Arr{
                converter convert
                path	&dir/revelle1_thumbnail_latest.gif
                table	thumbnails
                expression imagename == "SIO_Revelle_Axis1" && time > "-24:00"
                options
	}
	SIO_Revelle_Axis1_hires &Arr{
                path	&dir/revelle1_hires_latest
                expression imagename == "SIO_Revelle_Axis1" && time > "-24:00"
	}
	SIO_Revelle_Axis2 &Arr{
                converter convert
                path	&dir/revelle2_thumbnail_latest.gif
                table	thumbnails
                expression imagename == "SIO_Revelle_Axis2" && time > "-24:00"
                options
	}
	SIO_Revelle_Axis2_hires &Arr{
                path	&dir/SIO_Revelle_Axis2_hires_latest
                expression imagename == "SIO_Revelle_Axis2" && time > "-24:00"
	}
	SIO_Revelle_Axis3 &Arr{
                converter convert
                path	&dir/revelle3_thumbnail_latest.gif
                table	thumbnails
                expression imagename == "SIO_Revelle_Axis3" && time > "-24:00"
                options
	}
	SIO_Revelle_Axis3_hires &Arr{
                path	&dir/SIO_Revelle_Axis3_hires_latest
                expression imagename == "SIO_Revelle_Axis3" && time > "-24:00"
	}
	SIO_Revelle_Axis4 &Arr{
                converter convert
                path	&dir/revelle4_thumbnail_latest.gif
                table	thumbnails
                expression imagename == "SIO_Revelle_Axis4" && time > "-24:00"
                options
	}
	SIO_Revelle_Axis4_hires &Arr{
                path	&dir/SIO_Revelle_Axis4_hires_latest
                expression imagename == "SIO_Revelle_Axis4" && time > "-24:00"
	}
	SIO_Revelle_AxisQ &Arr{
                converter convert
                path	&dir/revelleq_thumbnail_latest.gif
                table	thumbnails
                expression imagename == "SIO_Revelle_AxisQ" && time > "-24:00"
                options
	}
	SIO_Revelle_AxisQ_hires &Arr{
                path	&dir/SIO_Revelle_AxisQ_hires_latest
                expression imagename == "SIO_Revelle_AxisQ" && time > "-24:00"
	}
	SIO_Revelle_deck &Arr{
                converter convert
                path	&dir/revelle_deck_thumbnail_latest.gif
                table	thumbnails
                expression imagename == "SIO_Revelle_deck" && time > "-24:00"
                options
	}
	SIO_Revelle_deck_hires &Arr{
                path	&dir/SIO_Revelle_deck_hires_latest
                expression imagename == "SIO_Revelle_deck" && time > "-24:00"
	}
	SMER_Gorge_Axis1 &Arr{
                converter convert
                path	&dir/smergorge1_thumbnail_latest.gif
                table	thumbnails
                expression imagename == "SMER_Gorge_Axis1" && &{daytime_subset}
                options
	}
	SMER_Gorge_Axis1_hires &Arr{
                path	&dir/SMER_Gorge_Axis1_hires_latest
                expression imagename == "SMER_Gorge_Axis1" && &{daytime_subset}
	}
	SMER_Gorge_Axis2 &Arr{
                converter convert
                path	&dir/smergorge2_thumbnail_latest.gif
                table	thumbnails
                expression imagename == "SMER_Gorge_Axis2" && &{daytime_subset}
                options
	}
	SMER_Gorge_Axis2_hires &Arr{
                path	&dir/SMER_Gorge_Axis2_hires_latest
                expression imagename == "SMER_Gorge_Axis2" && &{daytime_subset}
	}
	SMER_Gorge_Axis3 &Arr{
                converter convert
                path	&dir/smergorge3_thumbnail_latest.gif
                table	thumbnails
                expression imagename == "SMER_Gorge_Axis3" && &{daytime_subset}
                options
	}
	SMER_Gorge_Axis3_hires &Arr{
                path	&dir/SMER_Gorge_Axis3_hires_latest
                expression imagename == "SMER_Gorge_Axis3" && &{daytime_subset}
	}
	SMER_Gorge_Axis4 &Arr{
                converter convert
                path	&dir/smergorge4_thumbnail_latest.gif
                table	thumbnails
                expression imagename == "SMER_Gorge_Axis4" && &{daytime_subset}
                options
	}
	SMER_Gorge_Axis4_hires &Arr{
                path	&dir/SMER_Gorge_Axis4_hires_latest
                expression imagename == "SMER_Gorge_Axis4" && &{daytime_subset}
	}
	SMER_NORTH_Axis1 &Arr{
                converter convert
                path	&dir/smernorth1_thumbnail_latest.gif
                table	thumbnails
                expression imagename == "SMER_NORTH_Axis1" && &{daytime_subset}
                options
	}
	SMER_NORTH_Axis1_hires &Arr{
                path	&dir/SMER_NORTH_Axis1_hires_latest
                expression imagename == "SMER_NORTH_Axis1" && &{daytime_subset}
	}
	SMER_NORTH_Axis2 &Arr{
                converter convert
                path	&dir/smernorth2_thumbnail_latest.gif
                table	thumbnails
                expression imagename == "SMER_NORTH_Axis2" && &{daytime_subset}
                options
	}
	SMER_NORTH_Axis2_hires &Arr{
                path	&dir/SMER_NORTH_Axis2_hires_latest
                expression imagename == "SMER_NORTH_Axis2" && &{daytime_subset}
	}
	SMER_NORTH_Axis3 &Arr{
                converter convert
                path	&dir/smernorth3_thumbnail_latest.gif
                table	thumbnails
                expression imagename == "SMER_NORTH_Axis3" && &{daytime_subset}
                options
	}
	SMER_NORTH_Axis3_hires &Arr{
                path	&dir/SMER_NORTH_Axis3_hires_latest
                expression imagename == "SMER_NORTH_Axis3" && &{daytime_subset}
	}
}
.fi
.ft R
.in
.SH EXAMPLE
.in 2c
.ft CW
.nf

%\fB dbtimelapse /home/rt/db/images4\fP

%\fB dbtimelapse /home/rt/db/images4 PFO_hires\fP

%\fB dbtimelapse /home/rt/db/images4 PFO_hires\fP

%\fB dbtimelapse -v -i PFO_Borehole_iQeye -s "3/15/04 22:00" -e "3/16/04 00:00" /home/rt/db/images4 testmovie\fP
.fi
.ft R
.in
.SH LIBRARY
0.SH "BUGS AND CAVEATS"
\fBdbtimelapse\fP will probably need to track the created movies in a database table
at some point, which will allow better web interaction.

The \fImovie\fP creation process can be resource intensive.

\fBdbtimelapse\fP needs the path argument to be able to take epoch2str(3) escape-characters
so movies for specific time windows may be automatically generated and stored.

\fBdbtimelapse\fP might benefit from being able to create its own preconverted \fImovie\fP frames when
necessary.
.SH AUTHOR
.nf
Kent Lindquist
Lindquist Consulting
.fi
.\" $Id: dbtimelapse.1,v 1.8 2004/06/30 01:25:07 lindquis Exp $
